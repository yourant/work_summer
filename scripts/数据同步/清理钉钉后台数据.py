import requests
import json


# user_ids = [2259465, 2444539, 2444518, 2444541, 2232494, 2232496, 2232497, 1834202, 1843350, 1843496, 1843528, 1843260, 1844344, 1844348, 1843614, 1843685, 1843781, 1833884, 1844223, 2349113, 2349203, 2349256, 2349046, 2348716, 1843621, 1834692, 1843467, 2349216, 2349075, 2349258, 2349276, 2349286, 2349269, 1833701, 1832987, 1833345, 1844082, 1844140, 1844229, 1844034, 1844165, 1843606, 1844084, 1843747, 1844271, 1971148, 1971145, 2348778, 2348780, 2349087, 2699892, 1841003, 1840090, 1840838, 1840243, 1840661, 1839947, 1840153, 1839982, 1839901, 1840749, 1840891, 1839851, 1839843, 1839641, 1840028, 1839790, 1840315, 1872748, 1839755, 1839935, 1839649, 1872660, 1839880, 1839660, 1840339, 1839897, 1840498, 1840625, 1839812, 1840067, 1840178, 1840070, 1840351, 1840015, 1840723, 1840209, 1840130, 1840973, 1840708, 1840650, 1840745, 1840651, 1839953, 1840454, 1839973, 1840397, 1872708, 1872756, 1840376, 1840530, 1840497, 1839724, 1840552, 1839623, 1839584, 1840547, 1872752, 1840166, 1840948, 1840833, 1839780, 1839828, 1839686, 1839847, 1840550, 1839815, 1840710, 1840984, 1840600, 1840906, 1840185, 1840903, 1839768, 1839791, 1839710, 1839674, 1840340, 1840100, 1840137, 2349914, 2349005, 2349024, 2485380, 2767025, 1840679, 1839589, 1840687, 1840084, 1840131, 1839875, 1840966, 1840591, 1840458, 1839876, 1840438, 1839680, 1839698, 1840960, 1840945, 1840017, 1840258, 1840969, 1839781, 1840571, 1840403, 1840539, 1839809, 1840740, 1840612, 1839975, 1839590, 1840596, 1839762, 1840808, 1840575, 1840026, 1839703, 1840926, 1839860, 2015546, 1872729, 1840584, 1872731, 1840755, 1840311, 1840476, 1839587, 1839598, 1840889, 1840685, 1840800, 1840563, 1839749, 1840905, 1840485, 1840970, 1840292, 1840923, 1840952, 1839887, 1840107, 1839929, 1872740, 1840565, 1840735, 1840341, 1839969, 1840430, 1839807, 1840965, 1839892, 1840375, 1840546, 1839900, 1839884, 1840729, 1840421, 1840400, 1840862, 1872759, 1840317, 1840934, 1840197, 1840158, 1840817, 1840982, 1840069, 1840836, 1839808, 1840534, 1839950, 1839921, 1839840, 1840448, 1840682, 1839689, 1872747, 1872738, 1839940, 1840985, 1840274, 1839798, 1839651, 1840577, 1840553, 1840350, 1839718, 1840052, 1872754, 1839741, 1839789, 1840666, 1840501, 1839832, 1839913, 2018199, 2015747, 2015638, 2018216, 2016510, 2793982, 1844003, 1872508, 1872530, 1872656, 1872494, 1872500, 1872565, 1872497, 1872528, 2257332, 2280777, 2257433, 2349464, 2348533, 1843670, 1872524, 1872465, 1872506, 1872486, 1872504, 1833682, 1872472, 1872553, 2018204, 2266396, 2257431, 2300631, 2322847, 2322848, 2302630, 2448990, 1832135, 1831786, 1839647, 1832124, 1831823, 2253182, 1831839, 1832210, 1832234, 1832257, 1832141, 1832183, 1832275, 1832235, 1832307, 1832349, 1832149, 1832147, 2259451, 2349327, 1832297, 2302245, 2463938, 1832361, 1832364, 1831883, 1832310, 1831754, 1831779, 1832332, 1832296, 1832354, 1832331, 1847438, 1832264, 1832312, 1847437, 1847435, 1832295, 1832301, 1832286, 1831756, 1831774, 1832336, 1831797, 1832304, 1831784, 1832356, 1832175, 1832360, 1832327, 2329515, 1831830, 2010455, 2259449, 2012145, 2010425, 2259450, 2259447, 2259459, 2259466, 2259460, 2259454, 2217030, 2259470, 2282934, 2282928, 2259458, 2224551, 2282939, 2282937, 2259467, 2282941, 2289860, 2259471, 2298542, 2282938, 2296283, 2282943, 2282936, 2300603, 2308370, 2296224, 2323704, 2302236, 2282945, 2372048, 2352441, 2430795, 2453100, 2606925, 2472492, 2460410, 1835109, 1833009, 1844959, 1844952, 1844950, 2356229, 1844337, 1843828, 1843626, 1843465, 1844164, 1844146, 1844019, 1843298, 1843931, 1843462, 1844195, 1843623, 1843492, 1843746, 1843360, 1843325, 1844202, 1843431, 1843938, 1843566, 1843576, 1843637, 1843958, 1844252, 1843862, 1844208, 1844176, 1843518, 1843276, 1844317, 1843647, 1843988, 1843408, 1844167, 1843896, 1844318, 1844130, 1843776, 1844161, 1844232, 1844112, 1844077, 1843767, 1844038, 1844304, 1843785, 1844049, 2266194, 1838043, 1837533, 1838179, 2266193, 1837878, 1837414, 2266195, 1837810, 1837325, 1837274, 1838024, 1837918, 2296800, 2266192, 1837331, 1838134, 2348982, 2348988, 2348931, 2348970, 2348963, 2348909, 2348977, 2472736, 2559398, 2559363, 2559364, 2736626, 2559322, 1837447, 1838128, 1838059, 1838155, 1837682, 1837547, 1837268, 2266200, 1837498, 1837342, 1837506, 1837346, 1837336, 1837989, 1838174, 1837872, 1837723, 1838015, 1837548, 1837343, 1837591, 1837856, 1837685, 1837953, 1837665, 1837301, 1837237, 1838081, 1837418, 1838002, 1837912, 1837893, 1837592, 1837715, 1838194, 1837324, 1837335, 2266202, 1837779, 1837287, 2266198, 1837813, 1838146, 1837224, 1837194, 1837867, 1837421, 1837866, 1837507, 1837538, 1837518, 2015645, 1837367, 1837597, 1837223, 1837353, 1837925, 1837502, 1837525, 1837774, 1837754, 1837492, 1837861, 1838141, 1837529, 1837242, 1837909, 1838182, 1837408, 1838042, 2012000, 1837254, 1838151, 1837220, 1837551, 1837457, 2306146, 2305509, 2305543, 2305472, 2305534, 2305520, 2305493, 2306106, 2305486, 2305485, 2305505, 2305491, 2306123, 2306150, 2306151, 2306135, 2305528, 2306096, 2305544, 2305499, 2305503, 2305501, 2305760, 2281307, 2306119, 2305508, 2306112, 2305531, 2305545, 2305482, 2305506, 2306116, 2305496, 2305529, 2305492, 2306104, 2306111, 2305490, 2306098, 2306125, 2306141, 2310043, 2305494, 2306133, 2348933, 2305498, 2310042, 2559336, 2559427, 2560720, 2472743, 2559372, 2559354, 2559420, 2472741, 2559333, 2559338, 2559360, 2559337, 2559325, 2559347, 2559369, 2559393, 2472740, 2559410, 2559423, 2559402, 2559385, 2559397, 2559395, 2266203, 2266207, 2559401, 2559350, 2559348, 2559323, 2559315, 2559378, 2559417, 2559334, 2559365, 2559355, 2559377, 2559428, 2559424, 2559407, 2559358, 2490056, 2559339, 2559349, 2559335, 2559370, 2559430, 2559396, 2559416, 2559403, 2559379, 2559406, 2559432, 2559408, 2560726, 2490069, 2559405, 2559316, 2559327, 2559374, 2559367, 2559409, 2559400, 2559368, 2559330, 2490067, 2559412, 2490060, 2490058, 2559342, 2490068, 2697533, 2608764, 2701166, 2490071, 2318028, 2746554, 2771598, 1838416, 1839400, 1838586, 1838677, 1839393, 1838384, 1839258, 1839267, 1838578, 1839360, 1839172, 1839012, 1839247, 1839091, 1839344, 1839376, 1839181, 1839237, 1839363, 1839328, 1839006, 1839212, 1839332, 1838624, 1838538, 1838669, 1838576, 1839355, 1839384, 1839315, 1839283, 1839255, 1839365, 1839382, 1839369, 1839379, 1839397, 1839359, 1838884, 1839329, 1839390, 1839398, 1839361, 1839252, 1839396, 1839222, 1839278, 1839395, 1838739, 1839310, 1843452, 1838879, 1839008, 1838358, 1838888, 1838424, 2348888, 2349434, 2349018, 1839073, 1839449, 1839011, 1839453, 1838510, 1839285, 1838535, 1839223, 1838588, 1839345, 1838409, 1838878, 1839343, 1839372, 2253424, 2349432, 2349417, 2349431, 2349448, 2380447, 1838601, 1838690, 1838597, 1838701, 1839075, 1838418, 1839447, 1838893, 1838368, 1838797, 1838847, 1838651, 1838887, 1838965, 1838731, 1839238, 1838614, 1838993, 1838951, 1838495, 1839034, 1839060, 1838835, 1838761, 1838531, 1838422, 1838673, 1838724, 1838880, 1838689, 1838360, 1839445, 1839107, 1839116, 1839272, 1838498, 1839442, 1839441, 1838378, 1838512, 1839446, 1838445, 1838946, 1838898, 1838947, 1839215, 1838720, 1839030, 1839303, 1839209, 1839129, 1838474, 1839198, 1839059, 1838848, 1838758, 1839080, 1839420, 1839062, 1838423, 1839183, 1839013, 1839346, 1838869, 1839055, 1838693, 1838617, 1839456, 1838567, 1838910, 1838584, 1838924, 1838490, 2349447, 2349368, 2348858, 2348954, 2348598, 2351300, 2348589, 2348604, 2253551, 2350252, 2350258, 2741453, 1836934, 1836838, 1836588, 1836714, 1836099, 1836602, 1836832, 1836213, 1836441, 1836120, 1836654, 1836167, 1836057, 1836362, 1836696, 1836912, 1836041, 1836173, 1836220, 1835927, 1836520, 1835934, 1836215, 1836217, 1836033, 1895201, 2349296, 2349410, 2349293, 2349294, 2349352, 1836739, 1836725, 1836731, 1836726, 1836828, 1836855, 1836747, 2349457, 2349062, 1836580, 1836789, 1839849, 1839825, 1836101, 1836608, 1836366, 1836880, 1836118, 1836770, 1836672, 1836072, 1836636, 1836795, 1836431, 1836074, 1836605, 1836469, 1836357, 1836206, 2012723, 1836452, 1836531, 1836500, 1836681, 1836344, 1836742, 1836286, 1836915, 1836429, 1836277, 1836478, 1836488, 1836184, 1836261, 1836334, 1836461, 1836329, 1836248, 1836849, 1836459, 1835903, 1836086, 1836529, 1836457, 1835929, 1836689, 1836029, 1836151, 1836833, 1836198, 1836097, 1836479, 1836425, 1836572, 1836729, 1836798, 1836574, 1836360, 1836275, 1836848, 1836871, 1836628, 1836645, 1836330, 1836585, 1836721, 1836881, 1836783, 1836805, 1836142, 1836481, 1836542, 1835924, 1836781, 1836063, 1836604, 1836189, 1836245, 1836579, 1843733, 1836437, 1836533, 1836384, 1836658, 1836908, 1836131, 1836180, 1836674, 1836125, 1836453, 1836535, 1836182, 1836311, 1836319, 1836343, 1836269, 1836087, 1836573, 1836515, 1836839, 1836582, 1836570, 1872348, 1836012, 1836527, 1836266, 1836780, 1836216, 1836877, 1836895, 1836917, 1836793, 1836820, 1836699, 1836110, 1836186, 1836675, 1836899, 1836084, 1836891, 1836748, 1836303, 1836921, 2016597, 2349207, 2349707, 2349323, 2349463, 2349335, 2345752, 2345753, 2634067, 2766741, 1836094, 1836936, 1895208, 1895218, 1895219, 1829821, 1829723, 1895336, 1829725, 1872664, 2016456, 1831235, 1895404, 1829717, 1831242, 1895338, 1895395, 1895351, 1895367, 1829736, 1895373, 1895381, 1895360, 1895347, 1895343, 1895380, 1895368, 1895406, 1895401, 1895374, 1895399, 1895344, 1895383, 1895388, 1895375, 1895359, 1895376, 1895387, 1895346, 1895450, 1895349, 1895353, 1895348, 1895366, 1895405, 1895341, 1895372, 1895402, 1895358, 1895355, 1895400, 1895378, 1895357, 1895350, 1895342, 1895369, 1895382, 1895356, 1895340, 1895371, 1895354, 1895391, 1895370, 1895352, 1895377, 1895379, 1895361, 1895365, 1895362, 1895442, 1895441, 1895434, 1895446, 1895443, 1895439, 1895436, 1895440, 1895435, 1895433, 1895445, 1895444, 1895431, 1895438, 1895432, 1895437, 1895393, 1895389, 1895384, 1895386, 1895392, 1895364, 1895396, 1895390, 1895408, 1895363, 1895398, 1895397, 1895403, 1895394, 1895385, 1829776, 1829800, 1838008, 1829769, 1895410, 1895411, 1895412, 1895413, 1895414, 1895415, 1895416, 1895417, 1895418, 1895419, 1895420, 1895421, 1895422, 1895423, 1895424, 1895425, 1895426, 2224164, 1834873, 1831234, 1895206, 1895427, 1895428, 1895429, 1895430, 2240883, 2005081, 2258522, 1833276, 1834779, 1833561, 1833018, 1835096, 1834292, 1833998, 1833010, 1833001, 1834798, 1835535, 1834852, 1834583, 1834042, 1835838, 1835342, 1835595, 1835504, 1835888, 1835603, 1833213, 1833911, 1835791, 1833951, 1835122, 1835616, 1835346, 1833766, 1834134, 2016314, 1833003, 1835219, 1835600, 1833655, 1834972, 1834009, 1834108, 1833371, 1833421, 1835568, 1835412, 1834455, 1835032, 1834351, 1835700, 1835472, 1835311, 1835617, 1834163, 1834921, 1835815, 1833358, 1835430, 1835652, 1834149, 1835358, 1832962, 1835621, 1843676, 1843339, 1844325, 1844108, 1844160, 1843377, 1835597, 1833133, 1834902, 1843726, 1833574, 1833195, 1833539, 1834007, 1834045, 1834015, 1833815, 2010322, 1843710, 2016115, 2348925, 2348867, 2348785, 2804445, 1835098, 2012143, 1843700, 1843668, 1833351, 1832883, 1835035, 1833098, 1832995, 2271018, 1834713, 2348819, 2348802, 2348801, 2348850, 2348719, 2348812, 2348721, 1833508, 1835881, 1835505, 1833814, 1832977, 1834506, 1834021, 1835751, 1835367, 1834757, 1834746, 1835527, 1833897, 1835396, 1835134, 1835392, 1833284, 1835637, 1834449, 1832871, 1833278, 1832893, 1834109, 1833488, 1835253, 1833565, 1835606, 1834087, 1835697, 2018201, 1836060, 1834148, 1835224, 1834084, 1834729, 1833776, 2258698, 1835015, 1835158, 1835355, 1834604, 1834188, 1833503, 1835475, 1834946, 1835259, 1835542, 1835028, 1834347, 1834863, 1833534, 1834752, 1834426, 1833052, 1835712, 1835003, 1834961, 1834928, 1835694, 1834885, 1835255, 1835692, 1835137, 1833790, 1833015, 1833853, 1835693, 1833930, 1834413, 1835660, 1834332, 2010422, 1833348, 1833738, 1835065, 1833322, 1835388, 1834601, 1834892, 1834125, 1834135, 1834801, 1834644, 1833008, 1835471, 1835874, 1835272, 1835804, 2018215, 1833634, 1835103, 1834365, 1834741, 1834433, 1833433, 1833479, 1832991, 1833607, 1834204, 1835406, 1835298, 1833454, 1833673, 1843865, 1843447, 1843855, 1843782, 1844040, 1843620, 1843752, 1844073, 1834118, 1843410, 1843417, 1834373, 1834237, 1833326, 1833847, 1834716, 1834450, 1834483, 1835131, 1833901, 1833372, 1834336, 1834372, 2015751, 1833854, 1833680, 1835222, 1835192, 1834699, 1833166, 1833823, 1834706, 1835013, 1833292, 1835033, 1833694, 1835876, 1834654, 1833603, 1833972, 1834507, 1834973, 1833697, 1834989, 1835002, 1834132, 1833554, 1835282, 1835582, 1835633, 1844099, 2018194, 1833064, 1834402, 1834950, 1834003, 1833528, 1833381, 1833314, 1833307, 1834649, 1833418, 1835393, 1832913, 1833017, 1833237, 1835300, 1834205, 1863790, 1835453, 1835167, 1834322, 1833524, 1834046, 1834482, 1834474, 1835021, 1834610, 1834616, 1834011, 1834666, 1833449, 1835161, 1833746, 1833436, 1834696, 1833618, 1833695, 1833614, 1833486, 1835330, 1833859, 1834986, 1833679, 1833306, 1834403, 1833113, 1833356, 1835844, 1834948, 1833266, 1833641, 1835294, 1835670, 1835369, 1971080, 1844245, 1844261, 1844242, 1844227, 1971131, 2018208, 2011998, 1971119, 1971186, 2012163, 2015623, 1971076, 1971159, 1971191, 1971127, 1971157, 1971098, 1971092, 2011659, 1971069, 1971113, 1971110, 1971147, 2271068, 2012150, 2271019, 2012136, 2010397, 2011662, 2015628, 2016122, 2258696, 2258706, 2258694, 2258693, 2258701, 2258699, 2258704, 2258703, 2258679, 2258702, 2258705, 2258708, 2258687, 2348837, 2348732, 2318514, 2328650, 2436070, 2258844, 2436097, 2372354]

# access_token = '577bb81bc46c306a94dedee241403e9b'

# _url = 'https://oapi.dingtalk.com/topapi/v2/user/delete'

# headers = {"Content-Type": "application/json" }


# error_dict = {}
# success_list = []
# for user_id in user_ids:
#     try:
#         response = requests.post(f'{_url}?access_token={access_token}', data=json.dumps({'userid': str(user_id)}), headers=headers)
#         res_json = response.json()
#         if res_json.get('errcode') != 0:
#             error_dict[user_id] = res_json.get('errmsg')
#             print(res_json)
#         else:
#             success_list.append(user_id)
#     except Exception:
#         print('error')
#         pass

# print(error_dict)
# print(success_list)

access_token = '6fb8d57f0d223c41be3cc1dfb78cd05c'

current_id_list = [298332561, 334627676, 334669759, 372699581, 334710732, 334508841, 334945590, 334945590, 334945590, 334945590, 335078401, 454692556, 373682895, 483706223]

delete_depart_list = []


def get_sub_depart_ids(parent_id):
    url = f'https://oapi.dingtalk.com/topapi/v2/department/listsubid?access_token={access_token}'
    response = requests.post(url, json={'dept_id': parent_id})

    response = response.json()
    child_ids = response.get('result').get('dept_id_list')
    return child_ids

def delete_by_id(depart_id):
    url = f"https://oapi.dingtalk.com/topapi/v2/department/delete?access_token={access_token}"
    response = requests.post(url, json={'dept_id': depart_id})
    response = response.json()
    if response.get('errcode') == 0:
        with open('a.txt', 'a') as fp:
            fp.write(str(depart_id) + ',')
        return True
    return False

def delete_from_root_depat(root_id):
    child_ids = get_sub_depart_ids(root_id)
    if not child_ids:
        delete_by_id(root_id)
        return
    for child_id in child_ids:
        if child_id in current_id_list:
            pass
        else:
            delete_from_root_depat(child_id)
    delete_by_id(root_id)
        


if __name__ == "__main__":
    delete_from_root_depat(1)


